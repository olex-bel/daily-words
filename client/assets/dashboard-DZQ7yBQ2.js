import{D as h,p as e,w as m,a as u,C as b}from"./chunk-WWGJGFF6-8djDTm2d.js";import{f as p,h as f,i as j,M as w,j as N,k as E}from"./index-DKhaMfTd.js";import{u as o}from"./useTranslation-YS5tDbaE.js";import{f as g}from"./date-C38ZJWcO.js";import{S as l}from"./Surface-Br18wGdW.js";import{L as _}from"./LinkButton-BqM0ndVi.js";import{i as v}from"./profileService-CnHYnD1-.js";import{s as y}from"./supabase-B_K81v3k.js";function c(){const t=h();if(!t)throw new Error("useAuthContext must be used within an Authenticated Route");return t}function T(){const{t}=o(),{profile:a}=c();return e.jsxs("header",{className:"text-center md:text-left",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("h1",{className:"text-3xl font-black text-slate-800 tracking-tight",children:a?.name?t("dashboard.welcomeMessage",{name:a.name}):t("dashboard.welcomeMessageWithoutNmae")}),e.jsx(p,{className:"text-2xl text-orange-600 animate-wave"})]}),e.jsx("p",{className:"text-slate-500 mt-1",children:t("dashboard.heading")})]})}function L({entries:t}){const{t:a}=o();return e.jsxs("section",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-center px-1",children:e.jsx("h3",{className:"font-bold text-slate-700 uppercase text-xs tracking-widest",children:a("dashboard.lastAddedWords")})}),e.jsx("div",{className:"space-y-2",children:t.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white rounded-2xl border border-slate-100 shadow-sm hover:border-sky-200 transition-colors cursor-default",children:[e.jsx("span",{className:"font-bold text-slate-700",children:s.content}),e.jsx("span",{className:"text-xs text-slate-400 italic",children:s.created_at&&g(s.created_at)})]},s.id))})]})}function R({count:t}){const a=[...Array(t).keys()];return e.jsxs("section",{className:"space-y-4 animate-pulse",children:[e.jsx("div",{className:"flex justify-between items-center px-1",children:e.jsx("h3",{className:"font-bold text-slate-700 uppercase text-xs tracking-widest"})}),e.jsx("div",{className:"space-y-2",children:a.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white rounded-2xl border border-slate-100 shadow-sm hover:border-sky-200 transition-colors cursor-default",children:[e.jsx("div",{className:"h-5 w-32 bg-slate-200 rounded-lg"}),e.jsx("div",{className:"h-3 w-20 bg-slate-100 rounded-md"})]},s))})]})}function d({label:t,value:a,description:s,color:r,icon:n}){return e.jsxs(l,{className:`${r} border-none p-5 flex flex-col gap-1`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:"text-2xl font-black text-slate-800",children:a}),n]}),e.jsx("p",{className:"font-bold text-slate-700 text-sm mt-1",children:t}),e.jsx("p",{className:"text-[10px] text-slate-400 uppercase font-bold tracking-tighter",children:s})]})}function A({stats:t}){const{t:a}=o(),s=t.total_system_words>0?Math.round(t.mastered_words/t.total_system_words*100):0;return e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{label:a("dashboard.totalWords"),value:t.total_system_words,description:a("dashboard.wordsAvailable"),color:"bg-slate-100 text-slate-600",icon:e.jsx(f,{className:"text-2xl opacity-50"})}),e.jsx(d,{label:a("dashboard.personalProgress"),value:t.mastered_words,description:s>0?a("dashboard.learnedRate",{rate:s}):a("dashboard.noLearnedWords"),color:"bg-emerald-50 text-emerald-600",icon:e.jsx(j,{className:"text-2xl"})})]})}function S({status:t,stats:a}){const{t:s}=o();switch(t){case"CONTINUE":return e.jsxs(e.Fragment,{children:[s("dashboard.reviewStatus.CONTINUE.1"),e.jsx("strong",{children:s("dashboard.reviewStatus.CONTINUE.2")}),"."]});case"COMPLETED_TODAY":return e.jsxs(e.Fragment,{children:[s("dashboard.reviewStatus.COMPLETED_TODAY.1"),e.jsx("strong",{children:s("dashboard.reviewStatus.COMPLETED_TODAY.2")}),"."]});case"REVIEW_ONLY":return e.jsxs(e.Fragment,{children:[s("dashboard.reviewStatus.REVIEW_ONLY.1"),e.jsx("strong",{children:s("dashboard.reviewStatus.REVIEW_ONLY.2",{total:a.daily_task_total})}),"."]});case"START_NEW":return e.jsxs(e.Fragment,{children:[s("dashboard.reviewStatus.START_NEW.1"),e.jsx("strong",{children:s("dashboard.reviewStatus.START_NEW.2")}),"."]});default:return e.jsxs(e.Fragment,{children:[s("dashboard.reviewStatus.ALL_LEARNED.1"),e.jsx("strong",{children:s("dashboard.reviewStatus.ALL_LEARNED.2")}),"!"]})}}function k(t,a){const{daily_task_total:s,total_system_words:r,user_total_words:n,new_today:i}=t;return v(a)?s>0?"CONTINUE":"COMPLETED_TODAY":s===w?i===0?"REVIEW_ONLY":"CONTINUE":r>n?"START_NEW":"ALL_LEARNED"}function D({stats:t}){const{t:a}=o(),{profile:s}=c(),r=k(t,s),n=r!=="COMPLETED_TODAY"&&r!=="ALL_LEARNED";return e.jsxs(l,{className:"relative overflow-hidden border-none bg-sky-600 text-white p-8 group",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:a("dashboard.reviewTitle")}),e.jsx("p",{className:"text-ink mb-6 opacity-90",children:e.jsx(S,{stats:t,status:r})}),n&&e.jsx(_,{to:"/learning",className:"bg-white text-sky-600 font-black px-8 py-4 rounded-2xl shadow-xl shadow-sky-900/20 active:scale-95 transition-all uppercase",children:a("dashboard.startLearning")})]}),e.jsx(N,{className:"absolute -right-8 -bottom-8 text-white/10 text-[200px] rotate-12 group-hover:rotate-0 transition-transform duration-700"})]})}async function O(){const{data:t,error:a}=await y.rpc("get_dashboard_stats");if(a)throw new Error(a.message);return!Array.isArray(t)||t.length===0?null:t[0]}const x=3;async function B(){const t=await O();let a=null;if(!t)throw new Response("Unable to load dashboard",{status:500});return t.user_total_words>0&&(a=E(x)),{stats:t,recentEntries:a}}const G=m(function({loaderData:a}){const{t:s}=o(),{stats:r,recentEntries:n}=a;return e.jsxs("div",{className:"space-y-8 animate-in fade-in duration-500 pt-6",children:[e.jsx("title",{children:s("dashboard.meta.title")}),e.jsx("meta",{name:"description",content:s("dashboard.meta.description")}),e.jsx("meta",{name:"keywords",content:s("dashboard.meta.keywords")}),e.jsx(T,{}),e.jsx(D,{stats:r}),e.jsx(A,{stats:r}),n&&e.jsx(u.Suspense,{fallback:e.jsx(R,{count:x}),children:e.jsx(b,{resolve:n,errorElement:e.jsx("div",{}),children:i=>e.jsx(L,{entries:i})})})]})});export{B as clientLoader,G as default};
